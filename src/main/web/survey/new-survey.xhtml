<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xml:lang="en" lang="en">
<head>
    <title>New survey</title>
</head>
<body>
    <h1>New survey</h1>
    <h2>Create new survey</h2>
    <!-- Change survey title and description -->
    <h:form>
        <p:panelGrid id="infoGrid" columns="3">
            <p:outputLabel for="title" value="Survey title"/>
            <p:inputText id="title" required="true" value="#{newSurveyController.survey.title}" maxlength="80" size="80" placeholder="Survey title"/>
            <p:message for="title"/>

            <p:outputLabel for="description" value="Survey description"/>
            <p:inputTextarea id="description" value="#{newSurveyController.survey.description}" rows="6" cols="80" placeholder="Survey description (Optional)"/>
            <p:message for="description"/>
        </p:panelGrid>

        <!-- Show already created survey - questions and choices -->
        <c:if test="#{not empty newSurveyController.survey.questions}">
            <h3>Questions</h3>
            <ui:repeat value="#{newSurveyController.survey.questions}" var="question">
                <ui:remove>
                    <ui:include src="/WEB-INF/questions/show/#{question.type}-show.xhtml">
                        <ui:param name="question" value="#{question}"/>
                    </ui:include>
                    <p:commandButton actionListener="#{newSurveyController.editQuestion(question)}"/>
                    <p:commandButton actionListener="#{newSurveyController.removeQuestion(question)}"/>
                </ui:remove>

                <!-- Laikinai, bandymui-->

                    <ui:include src="/WEB-INF/questions/show/text-show.xhtml">
                        <ui:param name="question" value="#{question}"/>
                    </ui:include>
                    <p:commandButton value="Edit question" immediate="true" actionListener="#{newSurveyController.editQuestion(question)}"/>
                    <p:commandButton value="Remove question" immediate="true" actionListener="#{newSurveyController.removeQuestion(question)}"/>
                    <br/>

            </ui:repeat>
        </c:if>

        <!-- Save survey and show url in new page-->
        <br/>
        <p:commandButton value="Create survey"
                         actionListener="#{newSurveyController.createSurvey}"
                         ajax="true"/>
        <p:messages globalOnly="true"/>

    </h:form>
    <h:form>
        <!-- New question -->
        <c:if test="#{newSurveyController.newQuestion}">
            <!-- Choose new question type -->
            <ui:include src="/WEB-INF/questions/new-question.xhtml"/>
        </c:if>
        <c:if test="#{not newSurveyController.newQuestion}">
            <!-- Create new question and add choices OR edit question-->
            <ui:include src="/WEB-INF/questions/edit/#{newSurveyController.newQuestionType}-edit.xhtml"/>
        </c:if>
    </h:form>
</body>
</html>